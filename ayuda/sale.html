<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sale - Undisputed Clothing</title>
    <script src="usuarios.js"></script>
    <script src="productos.js"></script>
    <script src="script.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        .filter-options, .sort-options {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .filter-options p, .sort-options p {
            margin: 5px 0;
            cursor: pointer;
        }

        .filter-options p:hover, .sort-options p:hover {
            color: #202020;
            font-weight: bold;
        }
    </style>
    <script>
        window.onload = function() {
            var usuarioLogueado = JSON.parse(localStorage.getItem('usuarioLogueado'));
            if (!usuarioLogueado) {
                alert("Debe iniciar sesión para acceder a esta página");
                window.location.href = 'iniciarSesion.html';
            } else {
                cargarProductosEnOferta(); // Asegúrate de que los productos se carguen al inicio
            }
        };

        // Función para mostrar/ocultar las opciones de filtro
        function toggleFilterOptions() {
            var filterOptions = document.getElementById('filter-options');
            filterOptions.style.display = filterOptions.style.display === 'block' ? 'none' : 'block';
        }

        // Función para mostrar/ocultar las opciones de ordenar
        function toggleSortOptions() {
            var sortOptions = document.getElementById('sort-options');
            sortOptions.style.display = sortOptions.style.display === 'block' ? 'none' : 'block';
        }

        // Función para agregar un producto al carrito (validando la selección de talle)
        function agregarAlCarrito(producto) {
            var talleSelect = document.getElementById(`talle-${producto.Nombre}`);
            var talleSeleccionado = talleSelect.value;

            if (talleSeleccionado === "") {
                alert("Por favor, seleccione un talle antes de agregar el producto al carrito.");
                return;
            }

            producto.talle = talleSeleccionado;

            var carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            carrito.push(producto);
            localStorage.setItem('carrito', JSON.stringify(carrito));

            window.location.href = 'carrito.html';
        }
    </script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="logito undis-02.png" alt="Undisputed Logo">
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="index.html">INICIO</a></li>
                <li><a href="shop.html">SHOP</a></li>
                <li><a href="sale.html">SALE</a></li>
                <li><a href="moga_challenge.html">MOGA CHALLENGE</a></li>
            </ul>
        </nav>
        <div class="search-and-icons">
            <form id="search-form">
                <input type="text" placeholder="Buscar" id="search-input">
            </form>
            <a href="iniciarSesion.html">
                <img src="16467.png" alt="Iniciar Sesión" class="icon" onerror="this.style.display='none'">
            </a>
            <a href="carrito.html">
                <img src="carrito.png" alt="Carrito" class="icon" onerror="this.style.display='none'">
            </a>
        </div>
    </header>
    <main>
        <section class="sale-products">
            <h2>SALE</h2>
            <div class="filters">
                <button class="filter-btn" onclick="toggleFilterOptions()">Filtrar <img src="filter-512.webp" alt="Filter Icon"></button>
                <div id="filter-options" class="filter-options">
                    <p>Precio: Mayor a Menor</p>
                    <p>Precio: Menor a Mayor</p>
                    <p>Más vendidos</p>
                    <p>Mejor valorados</p>
                </div>

                <button class="sort-btn" onclick="toggleSortOptions()">Ordenar por <img src="Orden.png" alt="Sort Icon"></button>
                <div id="sort-options" class="sort-options">
                    <p>Novedades</p>
                    <p>Descuento</p>
                    <p>Popularidad</p>
                    <p>Alfabéticamente</p>
                </div>
            </div>
            <div id="productos-sale" class="productos-container"></div>
        </section>
    </main>
    <footer>
        <div class="footer-container">
            <div class="footer-column">
                <h3>AYUDA.</h3>
                <ul>
                    <li><a href="faq.html">Preguntas Frecuentes</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                    <li><a href="envios.html">Envíos</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>LEGALES.</h3>
                <ul>
                    <li><a href="terminos.html">Términos y Condiciones</a></li>
                    <li><a href="privacidad.html">Política de Privacidad</a></li>
                    <li><a href="devoluciones.html">Política de Devoluciones</a></li>
                </ul>
            </div>
            <div class="footer-column footer-logo">
                <img src="logito undis-01.png" alt="Logo">
                <p>&copy; 2024 UNDISPUTED CLOTHING. ALL RIGHTS RESERVED.</p>
            </div>
        </div>
    </footer>

    <script>
        function cargarProductosEnOferta() {
            var contenedor = document.getElementById('productos-sale');
            contenedor.innerHTML = ''; 

            var productosEnOferta = [
                {
                    "Nombre": "Hoodie en Oferta",
                    "Precio": "$80",
                    "PrecioOriginal": "$100",
                    "foto": "https://http2.mlstatic.com/D_NQ_NP_682348-MLA46725921582_072021-O.webp"
                },
                {
                    "Nombre": "Remera en Oferta",
                    "Precio": "$40",
                    "PrecioOriginal": "$50",
                    "foto": "https://blanks.com.ar/wp-content/uploads/2024/02/REMERA-LISA-BLANCA-DELANTERA-1.png"
                },
                {
                    "Nombre": "Baggy en Oferta",
                    "Precio": "$60",
                    "PrecioOriginal": "$70",
                    "foto": "https://oldtree.cl/wp-content/uploads/2023/10/old-tree-baggy-pant-lighblue.jpg"
                },
                {
                    "Nombre": "Gorra en Oferta",
                    "Precio": "$15",
                    "PrecioOriginal": "$20",
                    "foto": "https://http2.mlstatic.com/D_NQ_NP_956937-MLA70192125866_062023-O.webp"
                },
                {
                    "Nombre": "Boxy en Oferta",
                    "Precio": "$25",
                    "PrecioOriginal": "$30",
                    "foto": "https://acdn.mitiendanube.com/stores/001/177/291/products/boxyclassicblanca-espalda-16afc9b372cb4899c417138285399209-640-0.png"
                },
                {
                    "Nombre": "Jeans en Oferta",
                    "Precio": "$75",
                    "PrecioOriginal": "$90",
                    "foto": "https://m.media-amazon.com/images/I/61Iam2zJ4OL._AC_UY1000_.jpg"
                }
            ];

            productosEnOferta.forEach(function(producto) {
                var productoDiv = document.createElement('div');
                productoDiv.className = 'product';

                var img = document.createElement('img');
                img.src = producto.foto;
                img.alt = producto.Nombre;

                var nombre = document.createElement('h3');
                nombre.textContent = producto.Nombre;

                var precioOriginal = document.createElement('span');
                precioOriginal.className = 'precio-original';
                precioOriginal.textContent = producto.PrecioOriginal;

                var precio = document.createElement('span');
                precio.className = 'precio';
                precio.textContent = producto.Precio;

                var precioContainer = document.createElement('p');
                precioContainer.appendChild(precio);
                precioContainer.appendChild(precioOriginal);

                // Agregar selector de talle
                var talleLabel = document.createElement('label');
                talleLabel.textContent = "Talle:";

                var talleSelect = document.createElement('select');
                talleSelect.id = `talle-${producto.Nombre}`;  // ID único por producto
                var opcionesTalle = ["", "XS", "S", "M", "L", "XL", "XXL"];
                opcionesTalle.forEach(function(talle) {
                    var option = document.createElement('option');
                    option.value = talle;
                    option.textContent = talle;
                    talleSelect.appendChild(option);
                });

                var addToCartBtn = document.createElement('button');
                addToCartBtn.textContent = 'Añadir al carrito';
                addToCartBtn.onclick = function() {
                    agregarAlCarrito(producto);
                };

                productoDiv.appendChild(img);
                productoDiv.appendChild(nombre);
                productoDiv.appendChild(precioContainer);
                productoDiv.appendChild(talleLabel);
                productoDiv.appendChild(talleSelect);
                productoDiv.appendChild(addToCartBtn);

                contenedor.appendChild(productoDiv);
            });
        }
    </script>
</body>
</html>